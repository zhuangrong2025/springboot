define("#/shine-step/0.1.2/shine-step",["#/jquery/jquery","#/lodash/lodash","#/xyz-component-base/xyz-component-base","#/stringformat/stringformat","#/base-style-manage/base-style-manage"],function(t,e,i){var n=t("#/jquery/jquery"),s=t("#/lodash/lodash"),a=t("#/xyz-component-base/xyz-component-base"),o=t("#/stringformat/stringformat");t("#/base-style-manage/base-style-manage"),null;var r='<ul class="shine-steps"></ul>\n<div class="shine-steps-content"></div>\n<div class="shine-steps-button"></div>',h='<li class="shine-step {0} {1} {2}" li_id="{3}">\n    <a href="javascript:void(0)">\n        <div class="shine-step-num">{4}</div>\n        <div class="shine-step-title">{5}</div>\n    </a>\n</li>',c='<button class="btn {0} {1}">{2}</button>',d='<div class="shine-step-content {0}" id="{1}"></div>',p=a.extend({constructor:function(t){p.superclass.constructor.call(this,t),this.initialize(t)},initialize:function(t){var e=t.el;e="string"==typeof e?n(e):e,this.el=e;var i=t.config||[],a=s.uniq(i,"id");this.config=a,this.active=t.active,this.index=void 0===t.index?!0:t.index,this.events=t.events||{},this.buttons=t.buttons,this.modCache={}},render:function(){this.el.html(r),this._renderContent()},dispose:function(){var t=this.modCache||{};for(var e in t)t[e]&&t[e].modObj&&t[e].modObj.dispose();this.el.empty(),this.modCache={}},refresh:function(){this.dispose(),this.render()}});p.prototype._renderContent=function(){var t,e=this.config,i=[],n=[],a=this.active;if(a&&s.isNumber(a)&&a>=0){var r=[];s.each(e,function(t,e){t.active=e===a?!0:!1,r.push(t)}),t=a,e=r,this.config=e}else t=s.findIndex(e,function(t){return t.active===!0}),t=0>t?0:t;var c=null,p=(this.index,this);s.each(e,function(e,s){var a=e.id,r=e.title,l=(e.icon||[],""),v=s===t,f=t>s?"process":"",u=v?"active":"",m=e.finish===!0?"finish":"",y=e.child;p.modCache[a]={loaded:v},v&&(c={id:a,child:y}),y&&(l=y.path,p.modCache[a].options=y.options||{},p.modCache[a].refresh=y.refresh||!1,p.modCache[a].path=l);var b=o(h,u,f,m,a,s+1,r),C=o(d,u,a);i.push(b),n.push(C)}),this.el.find(".shine-steps").html(i.join("")),4!==e.length&&this.el.find(".shine-steps>.shine-step").css("width",parseInt(100/e.length,10)+"%"),this.el.find(".shine-steps-content").html(n.join("")),c&&this._renderChild(c.id,c.child),this._renderButtons(),this._bindEvents()};var l={cancel:{type:"cancel",title:"取消",cls:"btn-cancel-lv1"},prev:{type:"prev",title:"上一步",cls:"btn-action-lv2 hide"},presave:{type:"presave",title:"保存, 后续完善",cls:"btn-view-lv1 hide"},save:{type:"save",title:"保存",cls:"btn-action-lv1 hide"},next:{type:"next",title:"下一步",cls:"btn-action-lv1"}};p.prototype._renderButtons=function(){var t=[];this.buttons===!0&&(this.buttons=["cancel","prev","save","next"]),s.isArray(this.buttons)&&s.each(this.buttons,function(e){t.push(s.isString(e)?s.assign({},l[e]):s.assign(l[e.type],e))});var e=s.findIndex(t,function(t){return"presave"===t.type});if(-1!==e&&(this.presaveButton=t[e]),t.length){var i=[];s.each(t,function(t){var e=o(c,t.cls,t.type,t.title);i.push(e)}),this.el.find(".shine-steps-button").html(i.join("")),this._refreshButtons()}},p.prototype._bindEvents=function(){var t=this;if(this.events&&s.forEach(this.events,function(e,i){t.on(i,e,t)}),this.el.find(".shine-step").click(function(){var e=n(this);if(e.hasClass("active"))return!1;var i=e.attr("li_id");return t.activeById(i,!0)}),this.buttons){var e=this.el.find(".shine-steps-button");e.find(".btn.next").click(function(){var e=t.getCurrentCheckIndex();t.activeByIndex(e+1)}),e.find(".btn.prev").click(function(){var e=t.getCurrentCheckIndex();t.activeByIndex(e-1)}),e.find(".btn.save").click(function(){t.emit("save",t)}),e.find(".btn.presave").click(function(){t.emit("presave",t.getCurrentCheckIndex(),t.getCurrentCheckId(),t)}),e.find(".btn.cancel").click(function(){t.emit("cancel",t)})}},p.prototype._renderChild=function(e,i){if(i)if(this.modCache[e]&&this.modCache[e].modObj){if(this.modCache[e].refresh===!0){var n=this.modCache[e].modObj;n.refresh?n.refresh():(n.dispose&&n.dispose(),n.render())}}else{var a=i.path,o=this;t.async(a,function(t){if(!t)throw"无法获取子模块! path: "+a;var n={el:"#"+e},r=i.options;s.isFunction(r)&&(r=r()),s.extend(n,r||{});var h=new t(n);h.render(),o.modCache[e].modObj=h})}this.modCache[e].loaded=!0},p.prototype._isSameActive=function(t){var e=this.el.find(".shine-step-content.active"),i=e.attr("id");return t===i?!0:!1},p.prototype._active=function(t){if(!this._isSameActive(t)){this.el.find(".shine-step.active").removeClass("active"),this.el.find(".shine-step-content.active").removeClass("active");var e=o(".shine-step[li_id={0}]",t),i=this.el.find(e);i.addClass("active"),i.prevAll().addClass("process"),i.nextAll().removeClass("process"),n(".shine-step-content#"+t).addClass("active"),this.buttons&&this._refreshButtons()}},p.prototype._refreshButtons=function(){var t=this.getCurrentCheckIndex(),e=this.config.length,i={};i.prev=t>0?!0:!1,i.next=e-1>t?!0:!1,i.save=t===e-1?!0:!1,this.presaveButton&&s.isArray(this.presaveButton.scope)&&(i.presave=i.save===!0?!1:-1!==s.indexOf(this.presaveButton.scope,t)?!0:!1);var n=this.el.find(".shine-steps-button");s.each(i,function(t,e){var i=n.find(".btn."+e);t===!0?i.removeClass("hide"):i.addClass("hide")})},p.prototype.getInstanceById=function(t){return this.modCache[t]&&this.modCache[t].modObj},p.prototype.activeById=function(t,e){if(!this._isSameActive(t)){var i=this.events,n=i.beforeChange,s=i.change,a=this,o=a.isFinishStatus(t);e=void 0===e?!1:e;var r=function(){a._active(t);var i=a.modCache[t];a._renderChild(t,i),s&&s(t,e,o,a)};n?n(t,e,o,a,function(){r()}):r()}},p.prototype.activeByIndex=function(t){var e=this.config,i=e[t].id;this.activeById(i,!1)},p.prototype.getCurrentCheckId=function(){return this.el.find(".shine-step.active").attr("li_id")},p.prototype.getCurrentCheckIndex=function(){var t=this.getCurrentCheckId(),e=this.config;return s.findIndex(e,function(e){return e.id===t})},p.prototype.setFinishStatus=function(t){s.isString(t)&&(t=t.split(","));var e=this;s.each(t,function(t){var i=o(".shine-step[li_id={0}]",t);e.el.find(i).addClass("finish")})},p.prototype.removeFinishStatus=function(t){s.isString(t)&&(t=t.split(","));var e=this;s.each(t,function(t){var i=o(".shine-step[li_id={0}]",t);e.el.find(i).removeClass("finish")})},p.prototype.getFinishStatus=function(){var t=[];return n.each(this.el.find(".shine-step.finish"),function(e,i){var s=n(i).attr("li_id");t.push(s)}),t},p.prototype.isFinishStatus=function(t){var e=o(".shine-step[li_id={0}]",t);return this.el.find(e).hasClass("finish")},i.exports=p},{});